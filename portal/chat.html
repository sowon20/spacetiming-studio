<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Spacetime Director â€“ Chat</title>
  <link rel="stylesheet" href="/static/style.css" />
</head>
<body class="mode-mobile bg-forest-book">
  <div class="app">
    <!-- ìƒë‹¨ ì„¸ì´ì§€ íŒ¨ë„ -->
    <header class="top-panel">
      <div class="top-panel-row">
        <div>
          <div class="top-title-main">SPACETIME DIRECTOR</div>
          <div class="top-title-sub">ë¶€ê°ë… Â· ê°œì¸ ì„¸ì…˜</div>
        </div>
        <div class="top-actions">
          <div class="status-pill">
            <span class="status-dot"></span>
            <span>ONLINE</span>
          </div>
          <button class="icon-btn" type="button">
            ğŸ“<span>Call</span>
          </button>
        </div>
      </div>
      <div class="api-row">
        <div class="api-label">API ì‚¬ìš©ëŸ‰</div>
        <div class="api-bar-wrap">
          <div class="api-bar" id="apiBar"></div>
        </div>
        <div class="api-label" id="apiLabel">32%</div>
      </div>
    </header>

    <!-- í•€ ìº¡ìŠ ì˜ì—­ -->
    <section class="pin-strip">
      <div class="pin-capsule" id="pinCapsule">
        <div class="pin-capsule-main">
          <div class="pin-dot"></div>
          <div class="pin-text" id="pinText">í•€ ëœ ë©”ì‹œì§€ê°€ ì—¬ê¸°ì— ìš”ì•½ë¼ìš”.</div>
        </div>
        <button class="pin-close" type="button" id="pinClearBtn">âœ•</button>
      </div>
    </section>

    <!-- ë©”ì‹œì§€ ì˜ì—­ -->
    <main class="messages" id="messages">
      <div class="messages-inner" id="messagesInner">
        <!-- ì˜ˆì‹œ ë©”ì‹œì§€ë“¤ -->
        <div class="msg-row other">
          <div class="bubble-wrap" data-id="1">
            <button class="bubble-menu-toggle" type="button">â‹¯</button>
            <div class="bubble other">
              ë¶€ê°ë…ì…ë‹ˆë‹¤. ì˜¤ëŠ˜ ì‘ì—… íë¦„ ì •ë¦¬ë¶€í„° ê°ˆê¹Œ?
            </div>
            <div class="bubble-meta">21:40</div>
            <div class="bubble-menu">
              <button data-action="pin">í•€</button>
              <button data-action="edit">ìˆ˜ì •</button>
              <button data-action="delete">ì‚­ì œ</button>
              <button data-action="history">ê¸°ë¡</button>
            </div>
          </div>
        </div>

        <div class="msg-row me">
          <div class="bubble-wrap" data-id="2">
            <button class="bubble-menu-toggle" type="button">â‹¯</button>
            <div class="bubble me">
              ë ˆì´ì•„ì›ƒë§Œ ê¹”ë”í•˜ë©´ ë‚˜ë¨¸ì§„ ë‚´ê°€ ì±„ì›Œ ë„£ì„ê²Œ.
            </div>
            <div class="bubble-meta me">21:41</div>
            <div class="bubble-menu">
              <button data-action="pin">í•€</button>
              <button data-action="edit">ìˆ˜ì •</button>
              <button data-action="delete">ì‚­ì œ</button>
              <button data-action="history">ê¸°ë¡</button>
            </div>
          </div>
        </div>
      </div>
    </main>

    <!-- ì…ë ¥ ì˜ì—­ -->
    <section class="composer">
      <!-- ì²¨ë¶€ ë¯¸ë¦¬ë³´ê¸° -->
      <div class="attach-strip" id="attachStrip">
        <div class="attach-strip-inner" id="attachStripInner">
          <!-- JSë¡œ ì±„ì›Œì§ -->
        </div>
      </div>

      <div class="composer-hint">
        ì—”í„°: ì „ì†¡ Â· Shift+Enter: ì¤„ë°”ê¿ˆ
      </div>

      <div class="composer-row">
        <button class="attach-btn" type="button" id="attachBtn">ï¼‹</button>
        <div class="input-shell">
          <textarea
            id="input"
            class="input"
            rows="1"
            placeholder="ë©”ì‹œì§€ ì…ë ¥â€¦"
          ></textarea>
          <button class="send-btn" type="button" id="sendBtn">â¤</button>
        </div>
      </div>
    </section>
  </div>

  <script>
    // ì•„ì´í° vh ëŒ€ì‘
    function setVh() {
      document.documentElement.style.setProperty(
        "--vh",
        window.innerHeight * 0.01 + "px"
      );
    }
    window.addEventListener("resize", setVh);
    window.addEventListener("orientationchange", setVh);
    setVh();

    const messagesInner = document.getElementById("messagesInner");
    const pinCapsule = document.getElementById("pinCapsule");
    const pinText = document.getElementById("pinText");
    const pinClearBtn = document.getElementById("pinClearBtn");
    const inputEl = document.getElementById("input");
    const sendBtn = document.getElementById("sendBtn");
    const attachBtn = document.getElementById("attachBtn");
    const attachStrip = document.getElementById("attachStrip");
    const attachStripInner = document.getElementById("attachStripInner");

    function scrollToBottom() {
      const messages = document.getElementById("messages");
      messages.scrollTop = messages.scrollHeight;
    }

    scrollToBottom();

    // ì—”í„°ë¡œ ì „ì†¡, Shift+Enter ì¤„ë°”ê¿ˆ
    inputEl.addEventListener("keydown", (e) => {
      if (e.key === "Enter" && !e.shiftKey) {
        e.preventDefault();
        sendMessage();
      }
    });

    sendBtn.addEventListener("click", sendMessage);

    function sendMessage() {
      const text = inputEl.value.trim();
      if (!text) return;

      const row = document.createElement("div");
      row.className = "msg-row me";

      const wrap = document.createElement("div");
      wrap.className = "bubble-wrap";
      wrap.dataset.id = Date.now().toString();

      const toggle = document.createElement("button");
      toggle.className = "bubble-menu-toggle";
      toggle.type = "button";
      toggle.textContent = "â‹¯";

      const bubble = document.createElement("div");
      bubble.className = "bubble me";
      bubble.textContent = text;

      const meta = document.createElement("div");
      meta.className = "bubble-meta me";
      const now = new Date();
      meta.textContent =
        String(now.getHours()).padStart(2, "0") +
        ":" +
        String(now.getMinutes()).padStart(2, "0");

      const menu = document.createElement("div");
      menu.className = "bubble-menu";
      ["pin", "edit", "delete", "history"].forEach((action) => {
        const btn = document.createElement("button");
        btn.dataset.action = action;
        btn.textContent =
          action === "pin"
            ? "í•€"
            : action === "edit"
            ? "ìˆ˜ì •"
            : action === "delete"
            ? "ì‚­ì œ"
            : "ê¸°ë¡";
        menu.appendChild(btn);
      });

      wrap.appendChild(toggle);
      wrap.appendChild(bubble);
      wrap.appendChild(meta);
      wrap.appendChild(menu);
      row.appendChild(wrap);
      messagesInner.appendChild(row);

      inputEl.value = "";
      scrollToBottom();
    }

    // ë§í’ì„  ë©”ë‰´ í† ê¸€ + í•€/ì‚­ì œ ë“±
    messagesInner.addEventListener("click", (e) => {
      const toggle = e.target.closest(".bubble-menu-toggle");
      const menuBtn = e.target.closest(".bubble-menu button");

      if (toggle) {
        const wrap = toggle.closest(".bubble-wrap");
        const menu = wrap.querySelector(".bubble-menu");
        const allMenus = document.querySelectorAll(".bubble-menu");
        allMenus.forEach((m) => {
          if (m !== menu) m.classList.remove("show");
        });
        menu.classList.toggle("show");
        return;
      }

      if (menuBtn) {
        const action = menuBtn.dataset.action;
        const wrap = menuBtn.closest(".bubble-wrap");
        const bubbleEl = wrap.querySelector(".bubble");
        const menu = wrap.querySelector(".bubble-menu");

        if (action === "pin") {
          const text = bubbleEl.textContent || "";
          pinText.textContent = text;
          pinCapsule.style.display = "flex";
        } else if (action === "delete") {
          wrap.closest(".msg-row").remove();
        } else if (action === "edit") {
          inputEl.value = bubbleEl.textContent || "";
          inputEl.focus();
        } else if (action === "history") {
          // ë‚˜ì¤‘ì— ë¡œê·¸/íˆìŠ¤í† ë¦¬ ë¶™ì¼ ìë¦¬
          console.log("history clicked for", wrap.dataset.id);
        }

        menu.classList.remove("show");
      }
    });

    pinClearBtn.addEventListener("click", () => {
      pinCapsule.style.display = "none";
      pinText.textContent = "";
    });

    // ì²¨ë¶€ í”„ë¦¬ë·° ë°ëª¨
    let demoAttach = 0;
    attachBtn.addEventListener("click", () => {
      // ì‹¤ì œ êµ¬í˜„ì—ì„  íŒŒì¼ ì„ íƒ ë¶™ì´ë©´ ë¨. ì§€ê¸ˆì€ ë°ëª¨ìš©.
      demoAttach++;
      attachStrip.style.display = "block";
      const pill = document.createElement("div");
      pill.className = "attach-pill";

      const title = document.createElement("div");
      title.className = "attach-title";
      title.textContent = `íŒŒì¼-${demoAttach}.png`;

      const meta = document.createElement("div");
      meta.className = "attach-meta";
      meta.innerHTML = `<span>ì´ë¯¸ì§€</span>`;
      const remove = document.createElement("button");
      remove.className = "attach-remove";
      remove.type = "button";
      remove.textContent = "ì‚­ì œ";
      remove.addEventListener("click", () => {
        pill.remove();
        if (!attachStripInner.children.length) {
          attachStrip.style.display = "none";
        }
      });
      meta.appendChild(remove);

      pill.appendChild(title);
      pill.appendChild(meta);
      attachStripInner.appendChild(pill);
    });

    // ë°”ê¹¥ í´ë¦­ ì‹œ ë©”ë‰´ ë‹«ê¸°
    document.addEventListener("click", (e) => {
      if (e.target.closest(".bubble-wrap")) return;
      document
        .querySelectorAll(".bubble-menu.show")
        .forEach((m) => m.classList.remove("show"));
    });
  </script>
</body>
</html>