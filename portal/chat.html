<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <title>Sowon Â· Chat Portal</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
  <meta http-equiv="Pragma" content="no-cache">
  <meta http-equiv="Expires" content="0">
  <style>
    :root {
      --vh: 1vh;
      --bg-cream: #f4f0ea;
      --bg-cream-soft: #efe9e0;
      --sage-deep: #323732;
      --sage-mid: #3d433e;
      --sage-soft: #5a635b;
      --sand-deep: #8b7965;
      --text-main: #262522;
      --text-soft: #96938e;
      --text-softer: #aaa7a2;
    }

    * {
      box-sizing: border-box;
      -webkit-tap-highlight-color: transparent;
    }

    html, body {
      margin: 0;
      padding: 0;
      min-height: 100%;
      overflow-x: hidden;
      overflow-y: auto;
      font-family: -apple-system, BlinkMacSystemFont, system-ui, sans-serif;
      background: var(--bg-cream);
      color: var(--text-main);
      -webkit-text-size-adjust: 100%;
    }

    body {
      background: var(--bg-cream);
    }

    body.app-bg-forest {
      background-image: url("/static/backgrounds/forest_book.jpg");
      background-size: cover;
      background-position: center;
      background-repeat: no-repeat;
    }

    .app {
      min-height: 100vh;
      height: 100%;
      padding: 12px 12px calc(12px + env(safe-area-inset-bottom));
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    /* ìƒë‹¨ íŒ¨ë„ */

    .top-panel {
      background: rgba(24, 26, 24, 0.55);
      border-radius: 18px;
      padding: 10px 14px;
      display: flex;
      flex-direction: column;
      gap: 6px;
      color: #e8e3db;
      backdrop-filter: blur(16px) saturate(140%);
      -webkit-backdrop-filter: blur(16px) saturate(140%);
      box-shadow: 0 18px 40px rgba(5, 7, 6, 0.55);
    }

    .top-panel-row {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 8px;
    }

    .top-title-main {
      font-size: 13px;
      font-weight: 600;
      letter-spacing: 0.06em;
      text-transform: uppercase;
    }

    .top-title-sub {
      font-size: 11px;
      opacity: 0.8;
      margin-top: 2px;
    }

    .status-pill {
      font-size: 11px;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 2px 8px;
      border-radius: 999px;
      background: rgba(10, 12, 10, 0.32);
    }

    .status-dot {
      width: 7px;
      height: 7px;
      border-radius: 999px;
      background: #4bd37b;
    }

    .api-row {
      display: flex;
      align-items: center;
      gap: 8px;
      font-size: 11px;
      opacity: 0.9;
    }

    .api-label {
      opacity: 0.75;
    }

    .api-bar-wrap {
      flex: 1;
      height: 4px;
      border-radius: 999px;
      background: rgba(230, 224, 214, 0.22);
      overflow: hidden;
    }

    .api-bar {
      height: 100%;
      width: 32%;
      background: #e8e3db;
    }

    .top-actions {
      display: flex;
      flex-direction: row;
      align-items: center;
      justify-content: flex-end;
      gap: 8px;
    }

    .icon-btn {
      border: none;
      outline: none;
      width: 40px;
      height: 40px;
      border-radius: 999px;
      background: rgba(10, 10, 10, 0.4);
      color: #f5f2ec;
      font-size: 17px;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      padding: 0;
    }

    .icon-btn span {
      display: none;
    }

    .icon-btn:active {
      transform: scale(0.97);
    }

    /* í•€ ìº¡ìŠ */

    .pin-strip {
      min-height: 0;
    }

    .pin-capsule {
      display: none;
      align-items: center;
      justify-content: space-between;
      gap: 8px;
      padding: 6px 10px;
      border-radius: 10px;
      background: rgba(60, 67, 62, 0.22);
      font-size: 11px;
      color: #f2ede5;
    }

    .pin-capsule-main {
      display: flex;
      align-items: center;
      gap: 6px;
      min-width: 0;
    }

    .pin-dot {
      width: 6px;
      height: 6px;
      border-radius: 999px;
      background: #f7e3a2;
      flex-shrink: 0;
    }

    .pin-text {
      white-space: nowrap;
      text-overflow: ellipsis;
      overflow: hidden;
    }

    .pin-close {
      border: none;
      outline: none;
      background: none;
      color: #d9d3c8;
      font-size: 13px;
      cursor: pointer;
      flex-shrink: 0;
    }

    .pin-close:active {
      transform: scale(0.9);
    }

    /* ë©”ì‹œì§€ ì˜ì—­ */

    .messages {
      flex: 1 1 auto;
      min-height: 0;
      padding: 8px 4px;
      border-radius: 18px;
      background: rgba(255, 255, 255, 0.16);
      backdrop-filter: blur(18px);
      -webkit-backdrop-filter: blur(18px);
      overflow-y: auto;
      overflow-x: hidden;
      -webkit-overflow-scrolling: touch;
      font-size: 13px;
    }

    .messages-inner {
      padding: 4px 4px 8px;
    }

    .msg-row {
      display: flex;
      margin-bottom: 6px;
    }

    .msg-row.other {
      justify-content: flex-start;
    }

    .msg-row.me {
      justify-content: flex-end;
    }

    .bubble-wrap {
      max-width: 78%;
      position: relative;
      display: inline-flex;
      flex-direction: column;
      align-items: flex-start;
      gap: 2px;
    }

    .bubble {
      position: relative;
      padding: 8px 10px;
      border-radius: 18px;
      font-size: 13px;
      line-height: 1.4;
      word-break: break-word;
    }

    .bubble.other {
      background: var(--bg-cream-soft);
      color: var(--text-main);
      border-bottom-left-radius: 6px;
    }

    .bubble.me {
      background: var(--sage-mid);
      color: #f3eee5;
      border-bottom-right-radius: 6px;
    }


    .bubble-meta {
      font-size: 10px;
      color: #d6d2cc;
      align-self: flex-end;
      padding: 0 2px;
    }

    .msg-row.other .bubble-meta {
      align-self: flex-start;
      padding-left: 2px;
    }

    .msg-row.me .bubble-meta {
      align-self: flex-end;
      padding-right: 2px;
    }

    /* ë§í’ì„  ë©”ë‰´ */

    .bubble-menu-toggle {
      position: absolute;
      top: 50%;
      transform: translateY(-100%);
      width: 10px;
      height: 10px;
      border: none;
      border-radius: 999px;
      background: currentColor;
      cursor: pointer;
      padding: 0;
      font-size: 0; /* "â‹¯" í…ìŠ¤íŠ¸ëŠ” ìˆ¨ê¹€ */
      opacity: 0.8; /* ì‚´ì§ íˆ¬ëª…í•˜ê²Œ */
    }

    .msg-row.other .bubble-menu-toggle {
      right: -14px;
      left: auto;
      color: var(--bg-cream-soft); /* same tone as assistant bubble */
    }

    .msg-row.me .bubble-menu-toggle {
      left: -14px;
      right: auto;
      color: var(--sage-mid); /* same tone as my bubble */
    }

    .bubble-menu-toggle:active {
      opacity: 0.8; /* ì‚´ì§ë§Œ ëˆŒë¦¬ëŠ” ëŠë‚Œ, ìœ„ì¹˜ëŠ” ê·¸ëŒ€ë¡œ */
    }

    .bubble-menu {
      position: absolute;
      right: -6px;
      top: 22px;
      display: none;
      background: rgba(45, 50, 46, 0.9);
      border-radius: 999px;
      padding: 3px 6px;
      font-size: 11px;
      color: #f2eee5;
      white-space: nowrap;
      gap: 4px;
      align-items: center;
    }
    .msg-row.me .bubble-menu {
      left: -2px;
      right: auto;
    }

    .bubble-menu.show {
      display: inline-flex;
    }

    .bubble-menu button {
      border: none;
      background: none;
      padding: 3px 4px;
      border-radius: 999px;
      color: inherit;
      cursor: pointer;
    }

    .bubble-menu button:active {
      transform: scale(0.9);
    }

    /* ì‘ì„± ì˜ì—­ */

    .composer {
      flex: 0 0 auto;
      display: flex;
      flex-direction: column;
      gap: 6px;
    }

    .attach-strip {
      display: none;
      padding: 6px 0;
      border-radius: 10px;
      background: transparent;
      overflow-x: auto;
      -webkit-overflow-scrolling: touch;
    }

    .attach-strip-inner {
      display: inline-flex;
      gap: 8px;
    }

    .attach-pill {
      width: 80px;
      flex-shrink: 0;
      display: flex;
      flex-direction: column;
      gap: 4px;
      font-size: 11px;
    }

    .attach-thumb {
      position: relative;
      width: 100%;
      padding-top: 100%; /* ì •ì‚¬ê°í˜• */
      border-radius: 12px;
      background: rgba(244, 240, 234, 0.96);
      overflow: hidden;
    }

    .attach-remove {
      position: absolute;
      top: 4px;
      right: 4px;
      width: 18px;
      height: 18px;
      border-radius: 999px;
      border: none;
      background: rgba(0, 0, 0, 0.5);
      color: #f8f4ed;
      font-size: 11px;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
    }

    .attach-title {
      display: none;
      white-space: nowrap;
      text-overflow: ellipsis;
      overflow: hidden;
      text-align: center;
      color: var(--text-main);
    }

    .composer-hint {
      font-size: 10px;
      color: var(--text-soft);
      padding: 0 2px;
    }

    .composer-row {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .attach-btn {
      width: 30px;
      height: 30px;
      border-radius: 999px;
      border: none;
      outline: none;
      background: rgba(244, 240, 234, 0.98); /* ê±°ì˜ í°ìƒ‰ */
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 17px;
      cursor: pointer;
      color: var(--sage-mid);
      flex-shrink: 0;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.12);
    }

    .attach-btn:active {
      transform: scale(0.95);
    }

    .input-shell {
      flex: 1 1 auto;
      display: flex;
      align-items: center;
      padding: 6px 8px 6px 10px;
      border-radius: 16px;
      background: rgba(244, 240, 234, 0.9);
    }

    textarea.input {
      flex: 1;
      border: none;
      background: transparent;
      resize: none;
      outline: none;
      font: inherit;
      font-size: 16px;
      line-height: 1.4;
      max-height: 88px;
      color: var(--text-main);
    }

    .send-btn {
      border: none;
      outline: none;
      margin-left: 6px;
      width: 28px;
      height: 28px;
      border-radius: 999px;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      background: var(--sage-mid);
      color: #f3eee5;
      font-size: 14px;
    }

    .send-btn:active {
      transform: scale(0.95);
    }

    @media (min-width: 768px) {
      .app {
        max-width: 480px;
        margin: 0 auto;
      }
    }
    .messages::-webkit-scrollbar {
      width: 4px;
    }

    .messages::-webkit-scrollbar-track {
      background: transparent;
    }

    .messages::-webkit-scrollbar-thumb {
      background: rgba(90, 99, 91, 0.55);
      border-radius: 999px;
    }

    .messages {
      scrollbar-width: thin;
      scrollbar-color: rgba(90, 99, 91, 0.55) transparent;
    }
    /* ê°€ë¡œ ëª¨ë“œì—ì„œëŠ” ì „ì²´ ì•± ìˆ¨ê¸°ê³  ê²½ê³ ë§Œ í‘œì‹œ */
.landscape-warning {
  display: none;
}

@media (orientation: landscape) and (max-width: 900px) {
  .app {
    display: none;
  }

  .landscape-warning {
    position: fixed;
    inset: 0;
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 16px;
    background: rgba(10, 10, 10, 0.9);
    color: #f4f0ea;
    font-size: 14px;
    text-align: center;
  }
}
  </style>
</head>
<body class="app-bg-forest">
  <div class="app">
    <!-- ìƒë‹¨ ì„¸ì´ì§€ íŒ¨ë„ -->
    <header class="top-panel">
      <div class="top-panel-row">
        <div>
          <div class="top-title-main">SPACETIME DIRECTOR</div>
          <div class="top-title-sub">ë¶€ê°ë… Â· ê°œì¸ ì„¸ì…˜</div>
        </div>
        <div class="top-actions">
          <div class="status-pill">
            <span class="status-dot"></span>
            <span>ONLINE</span>
          </div>
          <button class="icon-btn" type="button">
            ğŸ“<span>Call</span>
          </button>
        </div>
      </div>
      <div class="api-row">
        <div class="api-label">API ì‚¬ìš©ëŸ‰</div>
        <div class="api-bar-wrap">
          <div class="api-bar" id="apiBar"></div>
        </div>
        <div class="api-label" id="apiLabel">32%</div>
      </div>
    </header>

    <!-- í•€ ìº¡ìŠ ì˜ì—­ -->
    <section class="pin-strip">
      <div class="pin-capsule" id="pinCapsule">
        <div class="pin-capsule-main">
          <div class="pin-dot"></div>
          <div class="pin-text" id="pinText">í•€ ëœ ë©”ì‹œì§€ê°€ ì—¬ê¸°ì— ìš”ì•½ë¼ìš”.</div>
        </div>
        <button class="pin-close" type="button" id="pinClearBtn">âœ•</button>
      </div>
    </section>

    <!-- ë©”ì‹œì§€ ì˜ì—­ -->
    <main class="messages" id="messages">
      <div class="messages-inner" id="messagesInner">
        <!-- ì˜ˆì‹œ ë©”ì‹œì§€ë“¤ -->
        <div class="msg-row other">
          <div class="bubble-wrap" data-id="1">
            <button class="bubble-menu-toggle" type="button">â‹¯</button>
            <div class="bubble other">
              ë¶€ê°ë…ì…ë‹ˆë‹¤. ì˜¤ëŠ˜ ì‘ì—… íë¦„ ì •ë¦¬ë¶€í„° ê°ˆê¹Œ?
            </div>
            <div class="bubble-meta">21:40</div>
            <div class="bubble-menu">
              <button data-action="pin">í•€</button>
              <button data-action="edit">ìˆ˜ì •</button>
              <button data-action="delete">ì‚­ì œ</button>
              <button data-action="history">ê¸°ë¡</button>
            </div>
          </div>
        </div>

        <div class="msg-row me">
          <div class="bubble-wrap" data-id="2">
            <button class="bubble-menu-toggle" type="button">â‹¯</button>
            <div class="bubble me">
              ë ˆì´ì•„ì›ƒë§Œ ê¹”ë”í•˜ë©´ ë‚˜ë¨¸ì§„ ë‚´ê°€ ì±„ì›Œ ë„£ì„ê²Œ.
            </div>
            <div class="bubble-meta me">21:41</div>
            <div class="bubble-menu">
              <button data-action="pin">í•€</button>
              <button data-action="edit">ìˆ˜ì •</button>
              <button data-action="delete">ì‚­ì œ</button>
              <button data-action="history">ê¸°ë¡</button>
            </div>
          </div>
        </div>
      </div>
    </main>

    <!-- ì…ë ¥ ì˜ì—­ -->
    <section class="composer">
      <!-- ì²¨ë¶€ ë¯¸ë¦¬ë³´ê¸° -->
      <div class="attach-strip" id="attachStrip">
        <div class="attach-strip-inner" id="attachStripInner">
          <!-- JSë¡œ ì±„ì›Œì§ -->
        </div>
      </div>


      <div class="composer-row">
        <button class="attach-btn" type="button" id="attachBtn">ï¼‹</button>
        <div class="input-shell">
          <textarea
            id="input"
            class="input"
            rows="1"
            placeholder="ë©”ì‹œì§€ ì…ë ¥â€¦"
          ></textarea>
          <button class="send-btn" type="button" id="sendBtn">â¤</button>
        </div>
      </div>
    </section>
  </div>

  <script>
    const messagesInner = document.getElementById("messagesInner");
    const pinCapsule = document.getElementById("pinCapsule");
    const pinText = document.getElementById("pinText");
    const pinClearBtn = document.getElementById("pinClearBtn");
    const inputEl = document.getElementById("input");
    const sendBtn = document.getElementById("sendBtn");
    const attachBtn = document.getElementById("attachBtn");
    const attachStrip = document.getElementById("attachStrip");
    const attachStripInner = document.getElementById("attachStripInner");

    // ì „ì²´ í˜ì´ì§€ì™€ ë©”ì‹œì§€ ì˜ì—­ì„ í•¨ê»˜ ë§¨ ì•„ë˜ë¡œ ìŠ¤í¬ë¡¤
    function scrollPageToBottom() {
      window.scrollTo(0, document.body.scrollHeight);
    }

    // ì…ë ¥ì°½ í¬ì»¤ìŠ¤ ì‹œ ìµœê·¼ ë©”ì‹œì§€ì™€ ì…ë ¥ì°½ì´ í•­ìƒ ë³´ì´ë„ë¡ ë³´ì •
    inputEl.addEventListener("focus", () => {
      scrollToBottom();
      scrollPageToBottom();
      setTimeout(() => {
        scrollToBottom();
        scrollPageToBottom();
      }, 200);
    });


    function scrollToBottom() {
      const messages = document.getElementById("messages");
      messages.scrollTop = messages.scrollHeight;
    }

    scrollToBottom();
    scrollPageToBottom();

    // textarea ìë™ ë†’ì´ ì¡°ì ˆ
    function autoResizeInput() {
      inputEl.style.height = "auto";
      const maxHeight = 88;
      const newHeight = Math.min(inputEl.scrollHeight, maxHeight);
      inputEl.style.height = newHeight + "px";
    }

    inputEl.addEventListener("input", autoResizeInput);
    autoResizeInput();

    // ì—”í„°ë¡œ ì „ì†¡, Shift+Enter ì¤„ë°”ê¿ˆ
    inputEl.addEventListener("keydown", (e) => {
      if (e.key === "Enter" && !e.shiftKey) {
        e.preventDefault();
        sendMessage();
      }
    });

    sendBtn.addEventListener("click", sendMessage);

    function sendMessage() {
      const text = inputEl.value.trim();
      if (!text) return;

      const row = document.createElement("div");
      row.className = "msg-row me";

      const wrap = document.createElement("div");
      wrap.className = "bubble-wrap";
      wrap.dataset.id = Date.now().toString();

      const toggle = document.createElement("button");
      toggle.className = "bubble-menu-toggle";
      toggle.type = "button";
      toggle.textContent = "â‹¯";

      const bubble = document.createElement("div");
      bubble.className = "bubble me";
      bubble.textContent = text;

      const meta = document.createElement("div");
      meta.className = "bubble-meta me";
      const now = new Date();
      meta.textContent =
        String(now.getHours()).padStart(2, "0") +
        ":" +
        String(now.getMinutes()).padStart(2, "0");

      const menu = document.createElement("div");
      menu.className = "bubble-menu";
      ["pin", "edit", "delete", "history"].forEach((action) => {
        const btn = document.createElement("button");
        btn.dataset.action = action;
        btn.textContent =
          action === "pin"
            ? "í•€"
            : action === "edit"
            ? "ìˆ˜ì •"
            : action === "delete"
            ? "ì‚­ì œ"
            : "ê¸°ë¡";
        menu.appendChild(btn);
      });

      wrap.appendChild(toggle);
      wrap.appendChild(bubble);
      wrap.appendChild(meta);
      wrap.appendChild(menu);
      row.appendChild(wrap);
      messagesInner.appendChild(row);

      inputEl.value = "";
      autoResizeInput();
      scrollToBottom();
    }

    // ë§í’ì„  ë©”ë‰´ í† ê¸€ + í•€/ì‚­ì œ ë“±
    messagesInner.addEventListener("click", (e) => {
      const toggle = e.target.closest(".bubble-menu-toggle");
      const menuBtn = e.target.closest(".bubble-menu button");

      if (toggle) {
        const wrap = toggle.closest(".bubble-wrap");
        const menu = wrap.querySelector(".bubble-menu");
        const allMenus = document.querySelectorAll(".bubble-menu");
        allMenus.forEach((m) => {
          if (m !== menu) m.classList.remove("show");
        });
        menu.classList.toggle("show");
        return;
      }

      if (menuBtn) {
        const action = menuBtn.dataset.action;
        const wrap = menuBtn.closest(".bubble-wrap");
        const bubbleEl = wrap.querySelector(".bubble");
        const menu = wrap.querySelector(".bubble-menu");

        if (action === "pin") {
          const text = bubbleEl.textContent || "";
          pinText.textContent = text;
          pinCapsule.style.display = "flex";
        } else if (action === "delete") {
          wrap.closest(".msg-row").remove();
        } else if (action === "edit") {
          inputEl.value = bubbleEl.textContent || "";
          inputEl.focus();
        } else if (action === "history") {
          // ë‚˜ì¤‘ì— ë¡œê·¸/íˆìŠ¤í† ë¦¬ ë¶™ì¼ ìë¦¬
          console.log("history clicked for", wrap.dataset.id);
        }

        menu.classList.remove("show");
      }
    });

    pinClearBtn.addEventListener("click", () => {
      pinCapsule.style.display = "none";
      pinText.textContent = "";
    });

    // ì²¨ë¶€ í”„ë¦¬ë·° ë°ëª¨
    let demoAttach = 0;
    attachBtn.addEventListener("click", () => {
      // ì‹¤ì œ êµ¬í˜„ì—ì„  íŒŒì¼ ì„ íƒ ë¶™ì´ë©´ ë¨. ì§€ê¸ˆì€ ë°ëª¨ìš©.
      demoAttach++;
      attachStrip.style.display = "block";
      const pill = document.createElement("div");
      pill.className = "attach-pill";

      const thumb = document.createElement("div");
      thumb.className = "attach-thumb";

      const remove = document.createElement("button");
      remove.className = "attach-remove";
      remove.type = "button";
      remove.textContent = "âœ•";
      remove.addEventListener("click", () => {
        pill.remove();
        if (!attachStripInner.children.length) {
          attachStrip.style.display = "none";
        }
      });
      thumb.appendChild(remove);

      const title = document.createElement("div");
      title.className = "attach-title";
      title.textContent = `íŒŒì¼-${demoAttach}.png`;

      pill.appendChild(thumb);
      pill.appendChild(title);
      attachStripInner.appendChild(pill);
    });

    // ë°”ê¹¥ í´ë¦­ ì‹œ ë©”ë‰´ ë‹«ê¸°
    document.addEventListener("click", (e) => {
      if (e.target.closest(".bubble-wrap")) return;
      document
        .querySelectorAll(".bubble-menu.show")
        .forEach((m) => m.classList.remove("show"));
    });
  </script>
</body>
</html>